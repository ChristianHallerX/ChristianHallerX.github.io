{"version":3,"sources":["webpack:///../src/common.ts","webpack:///../src/event-listeners.ts","webpack:///../src/event.ts","webpack:///../src/fetch.ts","webpack:///../src/history.ts","webpack:///../src/index.ts","webpack:///../src/rewrite-urls.ts","webpack:///../src/script.ts","webpack:///../src/scroll.ts","webpack:///../src/update.ts"],"names":[],"mappings":"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","file":"LEGACY-vendors~push-state-hydejack-9.0.4.js","sourcesContent":["export {\n  applyMixins,\n  subscribeWhen,\n  unsubscribeWhen,\n  filterWhen,\n  bufferDebounceTime,\n  fetchRx,\n  fragmentFromString,\n  createMutationObservable,\n  getScrollHeight,\n  getScrollLeft,\n  getScrollTop,\n  matches,\n  matchesAncestors\n} from '@hydecorp/component';\n\nexport enum Cause {\n  Init = \"init\",\n  Hint = \"hint\",\n  Push = \"push\",\n  Pop = \"pop\",\n};\n\nexport interface Context {\n  cause: Cause,\n  url: URL,\n  oldURL?: URL,\n  cacheNr?: number,\n  replace?: boolean,\n  error?: any,\n  anchor?: HTMLAnchorElement,\n}\n\nexport interface ClickContext extends Context {\n  event: MouseEvent,\n}\n\nexport function isExternal(\n  { protocol, host }: { protocol: string, host: string },\n  location: { protocol: string, host: string } = window.location,\n) {\n  return protocol !== location.protocol || host !== location.host;\n}\n\nexport function isHash(\n  { hash, origin, pathname }: { hash: string, origin: string, pathname: string },\n  location: { hash: string, origin: string, pathname: string } = window.location,\n) {\n  return hash !== \"\" && origin === location.origin && pathname === location.pathname;\n}\n\nexport function shouldLoadAnchor(anchor: HTMLAnchorElement) {\n  return anchor && anchor.target === \"\";\n}\n\nexport function isPushEvent({ url, anchor, event: { metaKey, ctrlKey } }: ClickContext, location: Location) {\n  return (\n    !metaKey &&\n    !ctrlKey &&\n    shouldLoadAnchor(anchor) &&\n    !isExternal(url, location)\n  );\n}\n\nexport function isHintEvent({ url, anchor }: Context, location: Location) {\n  return (\n    shouldLoadAnchor(anchor) &&\n    !isExternal(url, location) &&\n    !isHash(url, location)\n  );\n}\n\nexport function isHashChange({\n  cause,\n  url: { pathname, hash },\n  oldURL: { pathname: prevPathname },\n}: Context) {\n  return pathname === prevPathname && (cause === Cause.Pop || (cause === Cause.Push && hash !== ''));\n}\n","import { Subject, Observable, from, fromEvent, of, merge } from \"rxjs\";\n\nimport { matchesAncestors, createMutationObservable, subscribeWhen, bufferDebounceTime } from \"./common\";\nimport { map, filter, startWith, tap, flatMap, mergeAll, switchMap } from \"rxjs/operators\";\n\nconst flat = <T>(x: Array<Array<T>>): Array<T> => Array.prototype.concat.apply([], x);\n\nconst combineRecords = (records: MutationRecord[]) => ({\n  addedNodes: new Set(flat(records.map(r => Array.from(r.addedNodes)))),\n  removedNodes: new Set(flat(records.map(r => Array.from(r.removedNodes)))),\n});\n\nexport class EventListenersMixin {\n  el: HTMLElement;\n\n  linkSelector: string;\n\n  $: {\n    linkSelector?: Subject<string>;\n    prefetch?: Subject<boolean>;\n  }\n\n  // LINKS 2\n  setupEventListeners() {\n    const pushEvent$ = fromEvent(this.el, \"click\").pipe(\n      map(event => {\n        const anchor = matchesAncestors(event.target as Element, this.linkSelector);\n        if (anchor instanceof HTMLAnchorElement) {\n          return [event, anchor] as [MouseEvent, HTMLAnchorElement];\n        }\n      }),\n      filter(x => !!x),\n    );\n\n    const matchOrQuery = (el: Element, selector: string): Observable<Element> => {\n      if (el.matches(selector)) {\n        return of(el);\n      } else {\n        return from(el.querySelectorAll(selector));\n      }\n    }\n\n    const addEventListeners = (link: HTMLAnchorElement) => {\n      return merge(\n        fromEvent(link, \"mouseenter\", { passive: true }),\n        fromEvent(link, \"touchstart\", { passive: true }),\n        fromEvent(link, \"focus\", { passive: true }),\n      ).pipe(map(event => [event, link] as [Event, HTMLAnchorElement]))\n    };\n\n    const hintEvent$ = this.$.linkSelector.pipe(switchMap((linkSelector) => {\n      const links = new Map<HTMLAnchorElement, Observable<[Event, HTMLAnchorElement]>>();\n\n      const addLink = (link: HTMLAnchorElement) => {\n        if (!links.has(link)) {\n          links.set(link, addEventListeners(link));\n        }\n      }\n      const removeLink = (link: HTMLAnchorElement) => {\n        links.delete(link);\n      }\n\n      return createMutationObservable(this.el, { childList: true, subtree: true }).pipe(\n        startWith({ addedNodes: [this.el], removedNodes: [] }),\n        bufferDebounceTime(500),\n        map(combineRecords),\n        switchMap(({ addedNodes, removedNodes }) => {\n          from(removedNodes).pipe(\n            filter(el => el instanceof Element),\n            flatMap((el: Element) => matchOrQuery(el, linkSelector)),\n            tap(removeLink)\n          ).subscribe()\n\n          from(addedNodes).pipe(\n            filter(el => el instanceof Element),\n            flatMap((el: Element) => matchOrQuery(el, linkSelector)),\n            tap(addLink)\n          ).subscribe()\n\n          return from(links.values()).pipe(mergeAll());\n        }),\n        subscribeWhen(this.$.prefetch),\n      );\n    }));\n\n    return { hintEvent$, pushEvent$ }\n  }\n}\n","import { Context } from './common';\nimport { HyPushState } from \"./index\";\n\nconst timeout = (t: number) => new Promise(r => setTimeout(r, t));\n\nexport class EventManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  onStart(context: Context) {\n    this.parent.animPromise = timeout(this.parent.duration);\n\n    const transitionUntil = (promise: Promise<{}>) => {\n      this.parent.animPromise = Promise.all([this.parent.animPromise, promise]);\n    };\n\n    this.parent.fireEvent('start', { detail: { ...context, transitionUntil } });\n  }\n\n  emitDOMError(error: any) {\n    if (process.env.DEBUG) console.error(error);\n\n    // To open the link directly, we first pop one entry off the browser history.\n    // We have to do this because some browsers (Safari) won't handle the back button correctly otherwise.\n    // We then wait for a short time and change the document's location.\n    // TODO: If we didn't call `pushState` optimistically we wouldn't have to do this.\n    // TODO: Use browser sniffing instead?\n    const url = location.href;\n    window.history.back();\n    setTimeout(() => document.location.assign(url), 100);\n  }\n\n  emitNetworkError(context) {\n    if (process.env.DEBUG) console.error(context);\n    this.parent.fireEvent('networkerror', { detail: context });\n  }\n\n  emitError(context) {\n    if (process.env.DEBUG) console.error(context);\n    this.parent.fireEvent('error', { detail: context });\n  }\n\n  emitReady(context) {\n    this.parent.fireEvent('ready', { detail: context });\n  }\n\n  emitAfter(context) {\n    this.parent.fadePromise = timeout(this.parent.duration);\n\n    const transitionUntil = (promise: Promise<{}>) => {\n      this.parent.fadePromise = Promise.all([this.parent.fadePromise, promise]);\n    };\n\n    this.parent.fireEvent('after', { detail: { ...context, transitionUntil } });\n  }\n\n  emitProgress(context) {\n    this.parent.fireEvent('progress', { detail: context });\n  }\n\n  emitLoad(context) {\n    this.parent.fireEvent('load', { detail: context });\n  }\n};","import { of, zip, Observable } from \"rxjs\";\nimport { catchError, map, take, switchMap } from \"rxjs/operators\";\n\nimport { fetchRx, Context } from \"./common\";\nimport { HyPushState } from './index';\n\nexport interface ResponseContext extends Context {\n  responseText: string | null;\n  error?: any;\n};\n\nexport class FetchManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  fetchPage(context: Context): Observable<ResponseContext> {\n    return fetchRx(context.url.href, {\n      method: \"GET\",\n      mode: 'cors', ///isExternal(this.parent) ? 'cors' : undefined,\n      headers: { Accept: \"text/html\" },\n    })\n    .pipe(\n      switchMap(response => response.text()),\n      map(responseText => ({ ...context, responseText })),\n      catchError(error => of({ ...context, error, responseText: null })),\n    );\n  }\n\n  private selectPrefetch({ href }: URL, latestPrefetch: ResponseContext, prefetch$: Observable<ResponseContext>) {\n    return href === latestPrefetch.url.href // && latestPrefetch.error == null\n      ? of(latestPrefetch)\n      : prefetch$.pipe(take(1));\n  }\n\n  // Returns an observable that emits exactly one notice, which contains the response.\n  // It will not emit until an (optional) page transition animation completes.\n  getResponse(prefetch$: Observable<ResponseContext>, context: Context, latestPrefetch: ResponseContext) {\n    return zip(\n      this.selectPrefetch(context.url, latestPrefetch, prefetch$),\n      this.parent.animPromise,\n    ).pipe(\n      map(([prefetch]) => ({ ...prefetch, ...context }) as ResponseContext),\n    );\n  }\n};\n","import { isExternal, getScrollTop, getScrollHeight, Cause, Context } from \"./common\";\n\nimport { ReplaceContext } from \"./update\";\n\n// @ts-ignore\nwindow.HashChangeEvent = window.HashChangeEvent || function HashChangeEvent(type, { oldURL = '', newURL = '' } = {}) {\n  const e = new CustomEvent(type)\n  // @ts-ignore\n  e.oldURL = oldURL;\n  // @ts-ignore\n  e.newURL = newURL;\n  return e;\n}\n\nfunction simHashChange(newURL: URL, oldURL: URL) {\n  if (newURL.hash !== oldURL.hash) {\n    window.dispatchEvent(new HashChangeEvent('hashchange', { newURL: newURL.href, oldURL: oldURL.href }));\n  }\n}\n\nexport class HistoryManager {\n  private parent: Location & { histId: string, simulateHashChange: boolean };\n\n  constructor(parent: Location & { histId: string, simulateHashChange: boolean }) {\n    this.parent = parent;\n  }\n\n  updateHistoryState({ cause, replace, url, oldURL }: Context) {\n    if (isExternal(this.parent)) return;\n\n    switch (cause) {\n      case Cause.Init:\n      case Cause.Push: {\n        const { histId } = this.parent;\n\n        if (replace || url.href === location.href) {\n          const state = { ...history.state, [histId]: {} };\n          history.replaceState(state, document.title, url.href);\n        } else {\n          history.pushState({ [histId]: {} }, document.title, url.href);\n        }\n        // no break\n      }\n      case Cause.Pop: {\n        if (this.parent.simulateHashChange) simHashChange(url, oldURL);\n        break;\n      }\n      default: {\n        // if (process.env.DEBUG) console.warn(`Type '${cause}' not reconginzed`);\n        break;\n      }\n    }\n  }\n\n  updateTitle({ cause, title }: ReplaceContext) {\n    document.title = title;\n    if (!isExternal(this.parent) && cause === Cause.Push) {\n      history.replaceState(history.state, title);\n    }\n  }\n\n  updateHistoryScrollPosition = () => {\n    if (isExternal(this.parent)) return;\n\n    const state = this.assignScrollPosition(history.state || {});\n    history.replaceState(state, document.title);\n  }\n\n  private assignScrollPosition(state: object) {\n    const { histId } = this.parent;\n    return {\n      ...state,\n      [histId]: {\n        ...state[histId],\n        scrollTop: getScrollTop(),\n        scrollHeight: getScrollHeight(),\n      },\n    };\n  }\n};\n","/** \n * Copyright (c) 2020 Florian Klampfer <https://qwtel.com/>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n * \n * @license \n * @nocompile\n */\nimport { property, customElement } from 'lit-element';\n\nimport { Observable, Subject, BehaviorSubject, merge, defer, fromEvent, animationFrameScheduler } from \"rxjs\";\nimport { map, filter, tap, takeUntil, startWith, pairwise, share, mapTo, switchMap, distinctUntilChanged, withLatestFrom, catchError, observeOn } from 'rxjs/operators';\n\nimport { RxLitElement, createResolvablePromise } from '@hydecorp/component';\n\nimport { applyMixins, Context, Cause, ClickContext, isPushEvent, isHashChange, isHintEvent, filterWhen } from './common';\n\nimport { FetchManager, ResponseContext } from './fetch';\nimport { UpdateManager } from './update';\nimport { EventListenersMixin } from './event-listeners';\nimport { EventManager } from './event';\nimport { HistoryManager } from './history';\nimport { ScrollManager } from './scroll';\n\n@customElement('hy-push-state')\nexport class HyPushState \n    extends applyMixins(RxLitElement, [EventListenersMixin]) \n    implements Location, EventListenersMixin {\n\n  el: HTMLElement = this\n\n  createRenderRoot() { return this }\n\n  @property({ type: String, reflect: true, attribute: 'replace-selector' }) replaceSelector?: string;\n  @property({ type: String, reflect: true, attribute: 'link-selector' }) linkSelector: string = \"a[href]:not([data-no-push])\";\n  @property({ type: String, reflect: true, attribute: 'script-selector' }) scriptSelector?: string;\n  @property({ type: Boolean, reflect: true, attribute: 'prefetch' }) prefetch: boolean = false;\n  @property({ type: Number, reflect: true, attribute: 'duration' }) duration: number = 0;\n  // @property({ type: Boolean, reflect: true, attribute: 'simulate-load' }) simulateLoad: boolean = false;\n  @property({ type: Boolean, reflect: true, attribute: 'hashchange' }) simulateHashChange: boolean = false;\n\n  @property({ type: String }) baseURL: string = window.location.href;\n\n  _initialized = createResolvablePromise();\n  get initialized() {\n    return this._initialized;\n  }\n\n  $: {\n    linkSelector?: Subject<string>;\n    prefetch?: Subject<boolean>;\n  } = {}\n\n  animPromise: Promise<{}>;\n  fadePromise: Promise<{}> = Promise.resolve(null);\n\n  scrollManager = new ScrollManager(this);\n  historyManager = new HistoryManager(this);\n  fetchManager = new FetchManager(this);\n  updateManager = new UpdateManager(this);\n  eventManager = new EventManager(this);\n\n  private _url = new URL(this.baseURL)\n\n  private _setLocation(key: string, value: string) {\n    const u = new URL(this._url.href); \n    u[key] = value;\n    this.assign(u.href);\n  }\n\n  // Implement Location\n  get hash() { return this._url.hash }\n  get host() { return this._url.host }\n  get hostname() { return this._url.hostname }\n  get href() { return this._url.href }\n  get pathname() { return this._url.pathname }\n  get port() { return this._url.port }\n  get protocol() { return this._url.protocol }\n  get search() { return this._url.search }\n  get origin() { return this._url.origin }\n  get ancestorOrigins() { return window.location.ancestorOrigins }\n\n  set hash(value) { this._setLocation('hash', value) }\n  set host(value) { this._setLocation('host', value) }\n  set hostname(value) { this._setLocation('hostname', value) }\n  set href(value) { this._setLocation('href', value) }\n  set pathname(value) { this._setLocation('pathname', value) }\n  set port(value) { this._setLocation('port', value) }\n  set protocol(value) { this._setLocation('protocol', value) }\n  set search(value) { this._setLocation('search', value) }\n\n  // Silent read-only\n  set origin(_) { }\n  set ancestorOrigins(_) { }\n\n  // TODO: Setters\n\n  // EventListenersMixin\n  setupEventListeners: () => { \n    pushEvent$: Observable<[MouseEvent, HTMLAnchorElement]>;\n    hintEvent$: Observable<[Event, HTMLAnchorElement]>;\n  };\n\n  reload$ = new Subject<Context>();\n\n  // Methods\n  private cacheNr = 0;\n\n  get histId() { return this.id || this.tagName }\n\n  @property()\n  assign(url: string) {\n    this.reload$.next({\n      cause: Cause.Push,\n      url: new URL(url, this.href),\n      cacheNr: ++this.cacheNr,\n    });\n  }\n\n  @property()\n  reload() {\n    this.reload$.next({\n      cause: Cause.Push,\n      url: new URL(this.href),\n      cacheNr: ++this.cacheNr,\n      replace: true,\n    });\n  }\n\n  @property()\n  replace(url: string) {\n    this.reload$.next({\n      cause: Cause.Push,\n      url: new URL(url, this.href),\n      cacheNr: ++this.cacheNr,\n      replace: true,\n    });\n  }\n\n  compareContext(p: Context, q: Context) {\n    return p.url.href === q.url.href && p.error === q.error && p.cacheNr === q.cacheNr;\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n\n    this.$.linkSelector = new BehaviorSubject(this.linkSelector);\n    this.$.prefetch = new BehaviorSubject(this.prefetch);\n\n    // Remember the current scroll position (for F5/reloads).\n    window.addEventListener(\"beforeunload\", this.historyManager.updateHistoryScrollPosition);\n\n    this.updateComplete.then(this.upgrade)\n  }\n\n  upgrade = () => {\n    const { pushEvent$, hintEvent$ } = this.setupEventListeners();\n\n    const deferred: { response$?: Observable<ResponseContext> } = {};\n\n    const push$: Observable<ClickContext> = pushEvent$.pipe(\n      // takeUntil(this.subjects.disconnect),\n      map(([event, anchor]) => ({\n        cause: Cause.Push,\n        url: new URL(anchor.href, this.href),\n        anchor,\n        event,\n        cacheNr: this.cacheNr,\n      })),\n      filter(x => isPushEvent(x, this)),\n      tap(({ event }) => {\n        event.preventDefault();\n        this.historyManager.updateHistoryScrollPosition();\n      })\n    );\n\n    const pop$: Observable<Context> = fromEvent(window, \"popstate\").pipe(\n      // takeUntil(this.subjects.disconnect),\n      filter(() => window.history.state && window.history.state[this.histId]),\n      map(event => ({\n        cause: Cause.Pop,\n        url: new URL(window.location.href),\n        cacheNr: this.cacheNr,\n        event,\n      }))\n    );\n\n    const reload$ = this.reload$; // .pipe(takeUntil(this.subjects.disconnect));\n\n    const merged$ = merge<Context>(push$, pop$, reload$).pipe(\n      startWith({ url: new URL(window.location.href) } as Context),\n      pairwise(),\n      map(([old, current]) => Object.assign(current, { oldURL: old.url })), \n      share(),\n    );\n\n    const page$ = merged$.pipe(\n      filter(p => !isHashChange(p)),\n      share(),\n    );\n\n    const hash$ = merged$.pipe(\n      filter(p => isHashChange(p)),\n      filter(() => history.state && history.state[this.histId]),\n      observeOn(animationFrameScheduler),\n      tap(context => {\n        this.historyManager.updateHistoryState(context);\n        this.scrollManager.manageScrollPosition(context);\n      }),\n    );\n\n    const pauser$ = defer(() => merge(\n      page$.pipe(mapTo(true)),\n      deferred.response$.pipe(mapTo(false)),\n    )).pipe(\n      startWith(false),\n    );\n\n    const hint$: Observable<Context> = hintEvent$.pipe(\n      // takeUntil(this.subjects.disconnect),\n      filterWhen(pauser$.pipe(map(x => !x))),\n      map(([event, anchor]) => ({\n        cause: Cause.Hint,\n        url: new URL(anchor.href, this.href),\n        anchor,\n        event,\n        cacheNr: this.cacheNr,\n      })),\n      filter(x => isHintEvent(x, this)),\n    );\n\n    const prefetchResponse$ = merge(hint$, page$).pipe(\n      distinctUntilChanged((x, y) => this.compareContext(x, y)),\n      switchMap(x => this.fetchManager.fetchPage(x)),\n      startWith({ url: {} } as ResponseContext),\n      share(),\n    );\n\n    const response$ = deferred.response$ = page$.pipe(\n      tap(context => {\n        this.eventManager.onStart(context)\n        this.historyManager.updateHistoryState(context);\n        this._url = context.url;\n      }),\n      withLatestFrom(prefetchResponse$),\n      switchMap((args) => this.fetchManager.getResponse(prefetchResponse$, ...args)),\n      share(),\n    );\n\n    const responseOk$ = response$.pipe(filter(({ error }) => !error));\n    const responseError$ = response$.pipe(filter(({ error }) => !!error));\n\n    const main$ = responseOk$.pipe(\n      map(context => this.updateManager.responseToContent(context)),\n      tap(context => this.eventManager.emitReady(context)),\n      observeOn(animationFrameScheduler),\n      tap(context => {\n        this.updateManager.updateDOM(context);\n        this.historyManager.updateTitle(context)\n        this.eventManager.emitAfter(context);\n      }),\n      startWith({\n        cause: Cause.Init,\n        url: this._url,\n        scripts: [],\n      }),\n      observeOn(animationFrameScheduler),\n      tap(context => this.scrollManager.manageScrollPosition(context)),\n      tap({ error: (e) => this.eventManager.emitDOMError(e) }),\n      catchError((_, c) => c),\n      switchMap((x) => this.fadePromise.then(() => x)),\n      switchMap(x => this.updateManager.reinsertScriptTags(x)),\n      tap({ error: e => this.eventManager.emitError(e) }),\n      catchError((_, c) => c),\n      tap(context => this.eventManager.emitLoad(context)),\n    );\n\n    const error$ = responseError$.pipe(\n      tap(e => this.eventManager.emitNetworkError(e)),\n    );\n\n    const progress$ = page$.pipe(\n      switchMap(context =>\n        defer(() => this.animPromise).pipe(\n          takeUntil(response$),\n          mapTo(context),\n        ),\n      ),\n      tap(context => this.eventManager.emitProgress(context)),\n    );\n\n    // Subscriptions\n    main$.subscribe();\n    hash$.subscribe();\n    error$.subscribe();\n    progress$.subscribe();\n      \n    this._initialized.resolve(this);\n    this.fireEvent('init');\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener(\"beforeunload\", this.historyManager.updateHistoryScrollPosition);\n  }\n}\n","// When fetching documents from an external source,\n// relative URLs will be resolved relative to the current `window.location`.\n// We can rewrite URL to absolute urls\nexport function rewriteURLs(replaceEls: Element[], base: string) {\n  replaceEls.forEach((el) => {\n    el.querySelectorAll(\"[href]\").forEach(rewriteURL(\"href\", base));\n    el.querySelectorAll(\"[src]\").forEach(rewriteURL(\"src\", base));\n    el.querySelectorAll(\"img[srcset]\").forEach(rewriteURLSrcSet(\"srcset\", base));\n    el.querySelectorAll(\"blockquote[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"del[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"ins[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"q[cite]\").forEach(rewriteURL(\"cite\", base));\n    el.querySelectorAll(\"img[longdesc]\").forEach(rewriteURL(\"longdesc\", base));\n    el.querySelectorAll(\"frame[longdesc]\").forEach(rewriteURL(\"longdesc\", base));\n    el.querySelectorAll(\"iframe[longdesc]\").forEach(rewriteURL(\"longdesc\", base));\n    el.querySelectorAll(\"img[usemap]\").forEach(rewriteURL(\"usemap\", base));\n    el.querySelectorAll(\"input[usemap]\").forEach(rewriteURL(\"usemap\", base));\n    el.querySelectorAll(\"object[usemap]\").forEach(rewriteURL(\"usemap\", base));\n    el.querySelectorAll(\"form[action]\").forEach(rewriteURL(\"action\", base));\n    el.querySelectorAll(\"button[formaction]\").forEach(rewriteURL(\"formaction\", base));\n    el.querySelectorAll(\"input[formaction]\").forEach(rewriteURL(\"formaction\", base));\n    el.querySelectorAll(\"video[poster]\").forEach(rewriteURL(\"poster\", base));\n    el.querySelectorAll(\"object[data]\").forEach(rewriteURL(\"data\", base));\n    el.querySelectorAll(\"object[codebase]\").forEach(rewriteURL(\"codebase\", base));\n    el.querySelectorAll(\"object[archive]\").forEach(rewriteURLList(\"archive\", base));\n    /* el.querySelectorAll(\"command[icon]\").forEach(this.rewriteURL(\"icon\")); */ // obsolte\n  });\n}\n\nfunction rewriteURL(attr: string, base: string) {\n  return (el: Element) => {\n    try {\n      el.setAttribute(attr, new URL(el.getAttribute(attr), base).href);\n    } catch (e) {\n      // if (process.env.DEBUG) console.warn(`Couldn't rewrite URL in attribute ${attr} on element`, el);\n    }\n  };\n}\n\nfunction rewriteURLSrcSet(attr: string, base: string) {\n  return (el: Element) => {\n    try {\n      el.setAttribute(\n        attr,\n        el\n          .getAttribute(attr)\n          .split(/\\s*,\\s*/)\n          .map(str => {\n            const pair = str.split(/\\s+/);\n            pair[0] = new URL(pair[0], base).href;\n            return pair.join(\" \");\n          })\n          .join(\", \")\n      );\n    } catch (e) {\n      // if (process.env.DEBUG) console.warn(`Couldn't rewrite URLs in attribute ${attr} on element`, el);\n    }\n  };\n}\n\nfunction rewriteURLList(attr: string, base: string) {\n  return (el: Element) => {\n    try {\n      el.setAttribute(\n        attr,\n        el\n          .getAttribute(attr)\n          .split(/[\\s,]+/)\n          .map(str => new URL(str, base).href)\n          .join(\", \")\n      );\n    } catch (e) {\n      // if (process.env.DEBUG) console.warn(`Couldn't rewrite URLs in attribute ${attr} on element`, el);\n    }\n  };\n}","import { of, from } from \"rxjs\";\nimport { concatMap, catchError, finalize, mapTo } from \"rxjs/operators\";\n\nimport { HyPushState } from \".\";\n\nfunction cloneScript(script: HTMLScriptElement) {\n  const newScript = document.createElement('script');\n  Array.from(script.attributes).forEach(attr => newScript.setAttributeNode(attr.cloneNode() as Attr));\n  newScript.innerHTML = script.innerHTML;\n  return newScript;\n}\n\nexport class ScriptManager {\n  private parent: HyPushState;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n  }\n\n  get scriptSelector() { return this.parent.scriptSelector }\n\n  removeScriptTags(replaceEls: (Element|null)[]) {\n    const scripts: Array<[HTMLScriptElement, HTMLScriptElement]> = [];\n\n    replaceEls.forEach(el => {\n      if (el != null) el.querySelectorAll(this.scriptSelector).forEach((script: HTMLScriptElement) => {\n        const newScript = cloneScript(script);\n        const pair: [HTMLScriptElement, HTMLScriptElement] = [newScript, script];\n        scripts.push(pair);\n      });\n    });\n\n    return scripts;\n  }\n\n  reinsertScriptTags(context: { scripts: Array<[HTMLScriptElement, HTMLScriptElement]> }) {\n    if (!this.scriptSelector) return Promise.resolve(context);\n\n    const { scripts } = context;\n\n    const originalWrite = document.write;\n\n    return from(scripts).pipe(\n      concatMap(script => this.insertScript(script)),\n      catchError(error => of({ ...context, error })),\n      finalize(() => (document.write = originalWrite)),\n      mapTo(context),\n    )\n      .toPromise();\n  }\n\n  private insertScript([script, ref]: [HTMLScriptElement, HTMLScriptElement]): Promise<{}> {\n    document.write = (...args) => {\n      const temp = document.createElement(\"div\");\n      temp.innerHTML = args.join();\n      Array.from(temp.childNodes).forEach(node => ref.parentNode.insertBefore(node, ref));\n    };\n\n    return new Promise((resolve, reject) => {\n      if (script.src !== \"\") {\n        script.addEventListener(\"load\", resolve);\n        script.addEventListener(\"error\", reject);\n        ref.parentNode.replaceChild(script, ref);\n      } else {\n        ref.parentNode.replaceChild(script, ref);\n        resolve({});\n      }\n    });\n  }\n}","import { getScrollTop, Cause } from \"./common\";\n\ninterface ScrollState {\n  [k: string]: any;\n  scrollTop?: number;\n  scrollHeight?: number;\n}\n\nexport class ScrollManager {\n  private parent: { histId: string } & HTMLElement;\n\n  constructor(parent: { histId: string } & HTMLElement) {\n    this.parent = parent;\n    if ('scrollRestoration' in history) {\n      history.scrollRestoration = 'manual';\n    }\n  }\n\n  manageScrollPosition({ cause, url: { hash } }: { cause: Cause, url: URL }) {\n    switch (cause) {\n      case Cause.Push: {\n        // FIXME: make configurable\n        this.scrollHashIntoView(hash, { behavior: \"smooth\", block: \"start\", inline: \"nearest\" });\n        break;\n      }\n      case Cause.Pop: {\n        this.restoreScrollPosition();\n        break;\n      }\n      case Cause.Init: {\n        this.restoreScrollPositionOnReload();\n        break;\n      }\n    }\n  }\n\n  private elementFromHash(hash: string) {\n    return document.getElementById(decodeURIComponent(hash.substr(1)))\n  }\n\n  private scrollHashIntoView(hash: string, options: boolean | ScrollIntoViewOptions) {\n    if (hash) {\n      const el = this.elementFromHash(hash);\n      if (el) el.scrollIntoView(options);\n    } else {\n      window.scroll(window.pageXOffset, 0);\n    }\n  }\n\n  private restoreScrollPosition() {\n    const { histId } = this.parent;\n    const { scrollTop } = (history.state && history.state[histId]) || {} as ScrollState;\n\n    if (scrollTop != null) {\n      window.scroll(window.pageXOffset, scrollTop);\n    }\n  }\n\n  private restoreScrollPositionOnReload() {\n    const { histId } = this.parent;\n    const scrollState = history.state && history.state[histId];\n    // FIXME: As far as I can tell there is no better way of figuring out if the user has scrolled\n    //        and it doesn't work on hash links b/c the scroll position is going to be non-null by definition\n    if (scrollState && getScrollTop() === 0) {\n      this.restoreScrollPosition();\n    } else if (location.hash) {\n      requestAnimationFrame(() => this.scrollHashIntoView(location.hash, true));\n    }\n  }\n};\n","import { isExternal, fragmentFromString } from \"./common\";\n\nimport { ScriptManager } from \"./script\";\nimport { rewriteURLs } from \"./rewrite-urls\";\n\nimport { ResponseContext } from './fetch';\nimport { HyPushState } from \".\";\n\nconst CANONICAL_SEL = 'link[rel=canonical]';\nconst META_DESC_SEL = 'meta[name=description]';\n\nexport interface ReplaceContext extends ResponseContext {\n  title: string;\n  document: Document,\n  replaceEls: [Element] | Element[];\n  scripts: Array<[HTMLScriptElement, HTMLScriptElement]>;\n};\n\nexport class UpdateManager {\n  private parent: HyPushState;\n  private scriptManager: ScriptManager;\n\n  constructor(parent: HyPushState) {\n    this.parent = parent;\n    this.scriptManager = new ScriptManager(parent);\n  }\n\n  get el() { return this.parent.el; }\n  get replaceSelector() { return this.parent.replaceSelector; }\n  get scriptSelector() { return this.parent.scriptSelector; }\n\n  // Extracts the elements to be replaced\n  private getReplaceElements(doc: Document): Element[] {\n    if (this.replaceSelector) {\n      return this.replaceSelector.split(',').map(sel => doc.querySelector(sel));\n    } else if (this.el.id) {\n      return [doc.getElementById(this.el.id)];\n    } else {\n      const index = Array.from(document.getElementsByTagName(this.el.tagName)).indexOf(this.el);\n      return [doc.getElementsByTagName(this.el.tagName)[index]];\n    }\n  }\n\n  // Takes the response string and turns it into document fragments\n  // that can be inserted into the DOM.\n  responseToContent(context: ResponseContext): ReplaceContext {\n    const { responseText } = context;\n\n    const doc = new DOMParser().parseFromString(responseText, 'text/html');\n    const { title = '' } = doc;\n    const replaceEls = this.getReplaceElements(doc);\n\n    if (replaceEls.every(el => el == null)) {\n      throw new Error(`Couldn't find any element in the document at '${location}'.`);\n    }\n\n    const scripts = this.scriptSelector\n      ? this.scriptManager.removeScriptTags(replaceEls)\n      : [];\n\n    return { ...context, document: doc, title, replaceEls, scripts };\n  }\n\n  // Replaces the old elments with the new one, one-by-one.\n  private replaceContentWithSelector(elements: Element[]) {\n    this.replaceSelector\n      .split(',')\n      .map(sel => document.querySelector(sel))\n      .forEach((oldElement, i) => oldElement.parentNode.replaceChild(elements[i], oldElement));\n  }\n\n  // When no `relaceIds` are set, replace the entire content of the component (slow).\n  private replaceContentWholesale([el]: [Element]) {\n    this.el.innerHTML = el.innerHTML;\n  }\n\n  private replaceContent(replaceEls: Element[]) {\n    if (this.replaceSelector) {\n      this.replaceContentWithSelector(replaceEls);\n    } else {\n      this.replaceContentWholesale(replaceEls as [Element]);\n    }\n  }\n\n  private replaceHead(doc: Document)  {\n    const { head } = this.el.ownerDocument;\n\n    const canonicalEl = head.querySelector(CANONICAL_SEL) as HTMLLinkElement|null;\n    const cEl = doc.head.querySelector(CANONICAL_SEL) as HTMLLinkElement|null;\n    if (canonicalEl && cEl) canonicalEl.href = cEl.href;\n\n    const metaDescEl = head.querySelector(META_DESC_SEL) as HTMLMetaElement|null;\n    const mEl = doc.head.querySelector(META_DESC_SEL) as HTMLMetaElement|null;\n    if (metaDescEl && mEl) metaDescEl.content = mEl.content;\n  }\n\n  updateDOM(context: ReplaceContext) {\n    try {\n      const { replaceEls, document } = context;\n      if (isExternal(this.parent)) rewriteURLs(replaceEls, this.parent.href);\n      this.replaceHead(document)\n      this.replaceContent(replaceEls);\n    } catch (error) {\n      throw { ...context, error };\n    }\n  }\n\n  reinsertScriptTags(context: { scripts: Array<[HTMLScriptElement, HTMLScriptElement]> }) {\n    return this.scriptManager.reinsertScriptTags(context);\n  }\n}\n"],"sourceRoot":""}