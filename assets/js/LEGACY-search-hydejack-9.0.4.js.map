{"version":3,"sources":["webpack:///./_js/src/pro/search.js"],"names":["SEL_NAVBAR_BTN_BAR","relativeUrl","url","startsWith","window","_baseURL","join","smartUrl","includes","calcSrcSet","srcset","undefined","Object","entries","map","desc","stylesheetReady","pushStateEl","document","getElementById","searchFrag","importTemplate","workerHref","href","navbarEl","querySelector","children","searchBtnEl","searchBoxEl","hitsEl","insertBefore","searchInputEl","searchCloseEl","addEventListener","focus","select","classList","add","value","style","display","closeHandler","activeElement","blur","remove","once","worker","Worker","prevVal","fromEvent","pipe","tap","e","target","keyCode","preventDefault","switchMap","postMessage","items","length","render","html","repeat","item","assign","image","src","path","ifDefined","title","description","subscribe"],"mappings":"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","file":"LEGACY-search-hydejack-9.0.4.js","sourcesContent":["// Copyright (c) 2020 Florian Klampfer <https://qwtel.com/>\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport { join } from 'path';\n\nimport { fromEvent } from 'rxjs';\nimport { tap, switchMap } from 'rxjs/operators';\nimport { render, html } from 'lit-html';\nimport { repeat } from 'lit-html/directives/repeat';\nimport { ifDefined } from 'lit-html/directives/if-defined';\n\nimport { importTemplate, postMessage, once, stylesheetReady } from '../common';\n\nconst SEL_NAVBAR_BTN_BAR = '#_navbar > .content > .nav-btn-bar';\n\nconst relativeUrl = (url) => (url.startsWith(window._baseURL) ? url : join(window._baseURL, url));\n\nconst smartUrl = (url) => (url.includes('://') ? url : relativeUrl(url));\n\nconst calcSrcSet = (srcset) =>\n  !srcset\n    ? undefined\n    : Object.entries(srcset)\n        .map(([desc, url]) => `${smartUrl(url)} ${desc}`)\n        .join(',');\n\n(async () => {\n  await stylesheetReady;\n\n  const pushStateEl = document.getElementById('_pushState');\n\n  const searchFrag = importTemplate('_search-template');\n  const workerHref = document.getElementById('_hrefSearch')?.href;\n  if (searchFrag && workerHref) {\n    const navbarEl = document.querySelector(SEL_NAVBAR_BTN_BAR);\n    const [searchBtnEl, searchBoxEl, hitsEl] = searchFrag.children;\n    if (!searchBtnEl || !searchBoxEl || !hitsEl || !navbarEl) return;\n\n    navbarEl.insertBefore(searchBtnEl, navbarEl.querySelector('.nav-span'));\n    navbarEl.insertBefore(searchBoxEl, navbarEl.querySelector('.nav-span'));\n    navbarEl.insertBefore(hitsEl, navbarEl.querySelector('.nav-span'));\n\n    const searchInputEl = searchBoxEl.querySelector('input[type=search]');\n    const searchCloseEl = searchBoxEl.querySelector('button[type=reset]');\n    if (!searchInputEl || !searchCloseEl) return;\n\n    searchBtnEl.addEventListener('click', () => {\n      searchInputEl.focus();\n    });\n\n    searchInputEl.addEventListener('focus', () => {\n      searchInputEl.select();\n      searchBoxEl.classList.add('show');\n      if (searchInputEl.value !== '') hitsEl.style.display = '';\n    });\n\n    const closeHandler = () => {\n      document.activeElement?.blur();\n      searchBoxEl.classList.remove('show');\n      hitsEl.style.display = 'none';\n    };\n\n    hitsEl.style.display = 'none';\n\n    searchCloseEl.addEventListener('click', closeHandler);\n    pushStateEl?.addEventListener('hy-push-state-start', closeHandler);\n\n    // Load search worker after user interaction\n    await once(document, 'click');\n    const worker = new Worker(workerHref);\n    let prevVal = '';\n    fromEvent(searchInputEl, 'keyup')\n      .pipe(\n        tap((e) => {\n          if (e.target.value === '' && prevVal === '' && e.keyCode === 27) {\n            e.preventDefault();\n            closeHandler();\n          }\n          prevVal = e.target.value;\n        }),\n        switchMap((e) => postMessage(worker, e.target.value)),\n        tap((items) => {\n          if (items.length) {\n            render(\n              html`\n                <ul>\n                  ${repeat(\n                    items,\n                    (item) => item.url,\n                    (item) => html`\n                      <li class=\"search-item\" @click=${() => pushStateEl?.assign?.(item.url)}>\n                        <div class=\"search-img aspect-ratio sixteen-ten\">\n                          ${!item.image\n                            ? null\n                            : html`<img\n                                src=\"${smartUrl(item.image.src || item.image.path || item.image)}\"\n                                srcset=\"${ifDefined(calcSrcSet(item.image.srcset))}\"\n                                sizes=\"4.67rem\"\n                              />`}\n                        </div>\n                        <div class=\"search-text\">\n                          <p>\n                            <a class=\"heading\" href=${relativeUrl(item.url)}>${item.title}</a>\n                            <small>${item.url}</small>\n                          </p>\n                          ${item.description ? html` <p>${item.description}</p> ` : ''}\n                        </div>\n                      </li>\n                    `,\n                  )}\n                </ul>\n              `,\n              hitsEl,\n            );\n            hitsEl.style.display = '';\n          } else {\n            hitsEl.style.display = 'none';\n          }\n        }),\n      )\n      .subscribe();\n  }\n})();\n"],"sourceRoot":""}