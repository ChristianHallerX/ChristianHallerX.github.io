---
title: SQL Table Management
image: /assets/img/research/SQL_2/SQL_2_Cover.jpg
description: > 
  I accidentally dropped a table. Not.
---

0. this unordered seed list will be replaced by toc as unordered list
{:toc}

Database tables are split up into sub-tables to avoid saving redundant records.
This requires the maintenance of more complex systems, but it may be more efficient after all.
However, while querying and joining we can combine these tables again.
This post contains a number of SQL used for managing values, columns, tables, and databases.

Of course, the original tables and outputs are not available here, but the point is providing a lookup for structures and building blocks.



## Making and Deleting Tables

### Create Table

New tables can be created directly in SQL syntax.

~~~sql
CREATE TABLE table_name (
	column1 dtype,
	column2 dtype,
	column3 dtype
);
~~~

For example:

~~~sql
CREATE TABLE rocktypes (
	ID integer PRIMARY KEY,
	name text NOT NULL,
	type text UNIQUE,
	clevage_angle integer
);
~~~


Most common Data Types:


| DataType              | Description                    |
|-----------------------|--------------------------------|
| text                  | String of any length           |
| varchar[ (x) ]        | Maximum length of n characters |
| char[ (x) ]           | String of set length n         |
| boolean               | TRUE, FALSE, NULL              |
| date, time, timestamp | time formats                   |
| numeric               | no precision defined           |
| integer               | -2147483648 to 2147483647      |

<a href="https://www.postgresql.org/docs/9.5/datatype.html#DATATYPE-TABLE" target="_blank">PostgreSQL Documentation: DataType table</a>


### Drop Table

Delete the entire table.

~~~sql
DROP TABLE table_name;
~~~


## Insert Into

### Insert a Row

~~~sql
INSERT INTO table_name (existing_column1, existing_column2)
VALUES (val1, val2);
~~~

For Example:

~~~sql
INSERT INTO employee (firstname, lastname, department_shortname)
VALUES (NULL, 'Miller', 'SLS');
~~~

### Insert a Column

~~~sql
INSERT INTO table_name
SELECT column1
FROM old_table;
~~~

For Example:

Use DISTINCT to remove duplicate records.

~~~sql
INSERT INTO rocktypes
SELECT DISTINCT outcrop, handpiece
FROM samples;

/* double check */
SELECT *
FROM rocktypes;
~~~


## Alter Table

### Rename Column

Have you made a type when creating a table?

~~~sql
ALTER TABLE table_name
RENAME COLUMN old_colname TO new_colname;
~~~


### Add Column

~~~sql
ALTER TABLE table_name
ADD COLUMN id varchar(128);
~~~


### Drop Column

Delete a column in a table.

~~~sql
ALTER TABLE table_name
DROP COLUMN column_name;
~~~


### Column Type

After creation, the datatype of a column can still be modified.
Extension of a string lenghth is easy.

~~~sql
ALTER TABLE table_name
ALTER COLUMN column_name
TYPE varchar(256);
~~~

Shortening the length of a value requires a processing step first. For example, a float type gets rounded first and then cast to integer type.

~~~sql
ALTER TABLE table_name
ALTER COLUMN column_name
TYPE integer
USING ROUND(long_num_value);
~~~

For example, when shortening string entries,a 'SUBSTRING' has to be created first selecting the characters from 1 to x.

~~~sql
ALTER TABLE table_name
ALTER COLUMN column_name
TYPE varchar(16)
USING SUBSTRING(column_name FROM 1 FOR 16)
~~~


### Set Not Null, Drop Not Null

By default, a colum can contain NULL values. A column's 'NOT NULL' flag can be set after the table was created.

~~~sql
ALTER TABLE table_name
ALTER COLUMN column_name
SET NOT NULL;
~~~

Remove 'NOT NULL'.

~~~sql
ALTER TABLE table_name
ALTER COLUMN column_name
DROP NOT NULL;
~~~


### Unique Constraint

Note: The unique constraint will require a new column be created.

~~~sql
ALTER TABLE table_name
ADD CONSTRAINT new_col_name UNIQUE(column_name);
~~~


### Primary Key Constraint

~~~sql
ALTER TABLE table_name
ADD CONSTRAINT new_col_name PRIMARY KEY(old_col_name);
~~~


### Primary Key / Add Surrogate Key Column

Add a primary key serial type.	

~~~sql
ALTER Table table_name
ADD COLUMN id serial PRIMARY KEY;
~~~

### Foreign Key Constraint

Generate a foreign key column that references a primary key in another table.

The table 'a' should refer to 'table b', via 'b_id', which points to 'id'.


~~~sql
ALTER TABLE a 
ADD CONSTRAINT new_col_a_fkey FOREIGN KEY (a_id) REFERENCES b (id);
~~~

For example:

Inserting entries into the employees table that violate the foreign key table, e.g. non-existing company, will result in error.

~~~sql
ALTER TABLE employees 
ADD CONSTRAINT employees_fkey FOREIGN KEY (company_id) REFERENCES companies (id);
~~~


## CAST data types

If a column is numerical, but saved as text (string), we can on-the-fly cast the data type.

~~~sql
SELECT temp * CAST(wind_velocity AS integer) AS wind_chill
FROM weather;
~~~


